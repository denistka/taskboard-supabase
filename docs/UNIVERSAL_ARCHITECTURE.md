# Universal WebSocket Architecture (KISS, DRY, YAGNI)

## –ü—Ä–∏–Ω—Ü–∏–ø—ã

- **üß† KISS**: –ü—Ä–æ—Å—Ç–æ—Ç–∞ - –∫–æ–¥ –ø–æ–Ω—è—Ç–µ–Ω —Å—Ä–∞–∑—É
- **üîÅ DRY**: –ù–µ –¥—É–±–ª–∏—Ä—É–µ–º –ª–æ–≥–∏–∫—É - –æ–¥–∏–Ω –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã
- **üö´ YAGNI**: –ù–µ –¥–µ–ª–∞–µ–º —Ç–æ, —á—Ç–æ –Ω–µ –Ω—É–∂–Ω–æ —Å–µ–π—á–∞—Å

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### 1. **templates.js** - –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã
```javascript
// –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –∑–¥–µ—Å—å
export const QUERY_TEMPLATES = {
  BOARD: {
    GET_BY_ID: `query GetBoard($boardId: UUID!) { ... }`,
    CREATE: `mutation CreateBoard($input: boardInsertInput!) { ... }`
  },
  TASK: {
    GET_BY_BOARD: `query GetTasks($boardIds: [UUID!]!) { ... }`,
    CREATE: `mutation CreateTask($input: taskInsertInput!) { ... }`
  }
}
```

### 2. **orchestrator.js** - –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
```javascript
// –†–∞–±–æ—Ç–∞–µ—Ç —Å –ª—é–±—ã–º–∏ —à–∞–±–ª–æ–Ω–∞–º–∏
async processEvent(socket, event, wss) {
  const { type, template, action, payload } = event
  
  if (type.includes('db')) {
    const query = getQueryTemplate(template, action)
    const result = await dbClient.executeQuery(query, payload)
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
  }
  
  if (type.includes('presence')) {
    // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º presence
  }
}
```

### 3. **client.js** - –¢–æ–ª—å–∫–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤
```javascript
// –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –º–µ—Ç–æ–¥
async executeQuery(query, variables) {
  // –í—ã–ø–æ–ª–Ω—è–µ—Ç –ª—é–±–æ–π GraphQL –∑–∞–ø—Ä–æ—Å
}
```

### 4. **index.js** - –¢–æ–ª—å–∫–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
```javascript
// –û–±—Ä–∞–±–æ—Ç–∫–∞ WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
socket.on('request', async (data) => {
  await orchestrator.processEvent(socket, data, io)
})
```

## –§–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞

```javascript
{
  id: 'unique-id',
  type: ['db'],           // –∏–ª–∏ ['presence'] –∏–ª–∏ ['db', 'presence']
  template: 'board',      // –∏–ª–∏ 'task', 'user', etc
  action: 'get',          // –∏–ª–∏ 'create', 'update', 'delete', 'join', 'leave'
  payload: { boardId: '123' }
}
```

## –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

1. **–î–æ–±–∞–≤–∏—Ç—å —à–∞–±–ª–æ–Ω –≤ `templates.js`**:
```javascript
USER: {
  GET_PROFILE: `query GetUserProfile($userId: UUID!) { ... }`
}
```

2. **–ì–æ—Ç–æ–≤–æ!** - –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –Ω–æ–≤—É—é –æ–ø–µ—Ä–∞—Ü–∏—é

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

‚úÖ **–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ—Å—Ç—å**: –û–¥–∏–Ω –∫–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ª—é–±—ã–º–∏ —à–∞–±–ª–æ–Ω–∞–º–∏  
‚úÖ **–ü—Ä–æ—Å—Ç–æ—Ç–∞**: –ù–µ—Ç —Å–ª–æ–∂–Ω—ã—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤  
‚úÖ **–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å**: –î–æ–±–∞–≤–ª—è–µ–º –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ —à–∞–±–ª–æ–Ω—ã  
‚úÖ **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è**: –í—Å—è –ª–æ–≥–∏–∫–∞ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ  
‚úÖ **Hot-swappable**: –ù–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞  

## –†–µ—à–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

- ‚ùå **–ë—ã–ª–æ**: PresenceManager –Ω–µ —É–≤–µ–¥–æ–º–ª—è–ª –¥—Ä—É–≥–∏—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø—Ä–∏ disconnect
- ‚úÖ **–°—Ç–∞–ª–æ**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞ presence –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

- ‚ùå **–ë—ã–ª–æ**: –•–∞—Ä–¥–∫–æ–¥ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏  
- ‚úÖ **–°—Ç–∞–ª–æ**: –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç —Å –ª—é–±—ã–º–∏ —à–∞–±–ª–æ–Ω–∞–º–∏

- ‚ùå **–ë—ã–ª–æ**: –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –≤ —Ä–∞–∑–Ω—ã—Ö —Ñ–∞–π–ª–∞—Ö
- ‚úÖ **–°—Ç–∞–ª–æ**: –û–¥–∏–Ω –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã –≤ templates.js
